(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{446:function(_,v,e){"use strict";e.r(v);var t=e(52),a=Object(t.a)({},(function(){var _=this,v=_.$createElement,e=_._self._c||v;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("h1",{attrs:{id:"配置语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置语法"}},[_._v("#")]),_._v(" 配置语法")]),_._v(" "),e("h2",{attrs:{id:"waf"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf <"),e("em",[_._v("on")]),_._v(" | "),e("em",[_._v("off")]),_._v(" | "),e("em",[_._v("bypass")]),_._v(" >")]),_._v(" "),e("li",[_._v("默认配置：waf "),e("em",[_._v("off")])]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("开启、关闭或仅检测。")]),_._v(" "),e("ul",[e("li",[_._v("on: 开启防火墙。")]),_._v(" "),e("li",[_._v("off: 关闭防火墙。")]),_._v(" "),e("li",[_._v("bypass: 仅检测并记录日志，不拦截任何请求。")])]),_._v(" "),e("h2",{attrs:{id:"waf-zone"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-zone"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_zone")]),_._v(" "),e("Badge",{attrs:{text:">=v10.0.0",type:"tip"}})],1),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_zone <name="),e("em",[_._v("zone_name")]),_._v("> [size="),e("em",[_._v("5m")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：——")]),_._v(" "),e("li",[_._v("配置段: http")])]),_._v(" "),e("p",[_._v("创建一段共享内存，用于记录一些需要跨进程共享的信息，因为 nginx 的多进程模型。")]),_._v(" "),e("p",[_._v("在你使用某些配置时可能需要填写参数 "),e("code",[_._v("zone")]),_._v("，比如 "),e("a",{attrs:{href:"#waf-cc-deny"}},[_._v("waf_cc_deny")]),_._v("。\n填写格式为 "),e("code",[_._v("name:tag")]),_._v("，即名称和标签。名称和标签是 “多对多” 的关系，但是对于同一个 "),e("code",[_._v("zone")]),_._v("，\n标签名不能重复。")]),_._v(" "),e("p",[_._v("同一个 "),e("code",[_._v("zone")]),_._v(" 内的全部标签共用该 "),e("code",[_._v("zone")]),_._v(" 的全部的共享内存。出于性能考虑，建议为每个 "),e("code",[_._v("server")]),_._v(" 段创建一个 "),e("code",[_._v("zone")]),_._v("，\n最好不要多个 "),e("code",[_._v("server")]),_._v(" 段共用一个 "),e("code",[_._v("zone")]),_._v("，因为访问共享内存需要上锁，要尽量减少上锁的次数。")]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("估算所需的内存大小")]),_._v(" "),e("p",[_._v("经过估计，1M 的内存至少可以记录 4096 个 IP。")])]),_._v(" "),e("h2",{attrs:{id:"waf-rule-path"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-rule-path"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_rule_path")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_rule_path <"),e("em",[_._v("dir")]),_._v(">")]),_._v(" "),e("li",[_._v("默认配置：——")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("规则文件所在目录，且必须以"),e("code",[_._v("/")]),_._v("结尾。")]),_._v(" "),e("h2",{attrs:{id:"waf-mode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-mode"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_mode")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_mode <"),e("em",[_._v("mode_type")]),_._v("> ...")]),_._v(" "),e("li",[_._v("默认配置：——")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("指定防火墙的工作模式，至少指定一个模式，最多指定八个模式。")]),_._v(" "),e("p",[e("code",[_._v("mode_type")]),_._v("具有下列取值（不区分大小写）:")]),_._v(" "),e("ul",[e("li",[_._v("GET: 当"),e("code",[_._v("Http.Method=GET")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("HEAD: 当"),e("code",[_._v("Http.Method=HEAD")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("POST: 当"),e("code",[_._v("Http.Method=POST")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("PUT: 当"),e("code",[_._v("Http.Method=PUT")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("DELETE: 当"),e("code",[_._v("Http.Method=DELETE")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("MKCOL: 当"),e("code",[_._v("Http.Method=MKCOL")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("COPY: 当"),e("code",[_._v("Http.Method=COPY")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("MOVE: 当"),e("code",[_._v("Http.Method=MOVE")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("OPTIONS: 当"),e("code",[_._v("Http.Method=OPTIONS")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("PROPFIN: 当"),e("code",[_._v("Http.Method=PROPFIN")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("PROPPATCH: 当"),e("code",[_._v("Http.Method=PROPPATCH")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("LOCK: 当"),e("code",[_._v("Http.Method=LOCK")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("UNLOCK: 当"),e("code",[_._v("Http.Method=UNLOCK")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("PATCH: 当"),e("code",[_._v("Http.Method=PATCH")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("TRAC: 当"),e("code",[_._v("Http.Method=TRAC")]),_._v("时启动检查。")]),_._v(" "),e("li",[_._v("CMN-METH：等价于 "),e("code",[_._v("HEAD GET POST")]),_._v("。")]),_._v(" "),e("li",[_._v("ALL-METH：任意的 HTTP 请求方法都会启动检查。")]),_._v(" "),e("li",[_._v("IP: 启用 IP 地址的检查规则。")]),_._v(" "),e("li",[_._v("URL: 启用 url 的检查规则。")]),_._v(" "),e("li",[_._v("RBODY: 启用 POST 请求体的检查规则。")]),_._v(" "),e("li",[_._v("ARGS: 启用 args 的检查规则。")]),_._v(" "),e("li",[_._v("UA: 启用 user-agent 的检查规则。")]),_._v(" "),e("li",[_._v("COOKIE: 启用 cookie 的检查规则。")]),_._v(" "),e("li",[_._v("REFERER: 启用 referer 的检查规则。")]),_._v(" "),e("li",[_._v("CC: 启用 CC 防御。"),e("strong",[_._v("当你启用了此模式，你必须设置 "),e("a",{attrs:{href:"#waf-cc-deny"}},[_._v("waf_cc_deny")]),_._v("。")])]),_._v(" "),e("li",[_._v("ADV：启用高级规则。")]),_._v(" "),e("li",[_._v("LIB-INJECTION-SQLI：使用 "),e("a",{attrs:{href:"https://github.com/libinjection/libinjection",target:"_blank",rel:"noopener noreferrer"}},[_._v("libinjection"),e("OutboundLink")],1),_._v(" 检测 SQL 注入。")]),_._v(" "),e("li",[_._v("LIB-INJECTION-XSS：使用 "),e("a",{attrs:{href:"https://github.com/libinjection/libinjection",target:"_blank",rel:"noopener noreferrer"}},[_._v("libinjection"),e("OutboundLink")],1),_._v(" 检测 XSS 攻击。")]),_._v(" "),e("li",[_._v("LIB-INJECTION：等价于 "),e("code",[_._v("LIB-INJECTION-SQLI LIB-INJECTION-XSS")]),_._v("。")]),_._v(" "),e("li",[_._v("CACHE：启用缓存。启用此模式后会缓存检查的结果，下次检查相同的目标时就不需要重复检查了。不过不会缓存 POST 体的检查结果。比如一个 URL 经过检查后并没有在黑名单中，那么下次检查相同的 URL 时就无需再次检查 URL 黑名单了。"),e("strong",[_._v("当你启用了此模式，你必须设置 "),e("a",{attrs:{href:"#waf-cache"}},[_._v("waf_cache")])]),_._v("。")]),_._v(" "),e("li",[_._v("STD：标准工作模式，等价于 "),e("code",[_._v("HEAD GET POST IP URL RBODY ARGS UA CC CACHE LIB-INJECTION-SQLI")]),_._v("。")]),_._v(" "),e("li",[_._v("STATIC：适用于静态站点的工作模式，等价于 "),e("code",[_._v("HEAD GET IP URL UA CC CACHE")]),_._v("。")]),_._v(" "),e("li",[_._v("DYNAMIC：适用于动态站点的工作模式，等价于 "),e("code",[_._v("HEAD GET POST IP URL ARGS UA RBODY COOKIE CC CACHE LIB-INJECTION-SQLI")]),_._v("。")]),_._v(" "),e("li",[_._v("FULL: 启用所有的模式。")]),_._v(" "),e("li",[_._v("[数据删除]: 启用此模式会[数据删除]。")])]),_._v(" "),e("p",[_._v("您可以通过在某个 "),e("code",[_._v("mode_type")]),_._v(" 前增加 "),e("code",[_._v("!")]),_._v(" 前缀来关闭该模式，下面是一个例子。\n表示使用标准的工作模式，但是不检查 User-Agent。")]),_._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("waf_mode")]),_._v(" STD !UA")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[_._v("注意")]),_._v(" "),e("p",[_._v("如果同时启用两个及以上的存在冲突的模式，则靠右的模式会覆盖它左边的模式。下面的例子表示检查 User-Agent。")]),_._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("waf_mode")]),_._v(" !UA STD")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("注意")]),_._v(" "),e("p",[e("code",[_._v("CC")]),_._v("是独立于其它模式的模式，其生效与否不受到其它模式的影响。典型情况如"),e("code",[_._v("URL")]),_._v("模式会受到"),e("code",[_._v("GET")]),_._v("模式的影响，因为如果不使用"),e("code",[_._v("GET")]),_._v("模式，那么在收到"),e("code",[_._v("GET")]),_._v("请求时就不会启动检查，自然也就不会检查 URL，但是"),e("code",[_._v("CC")]),_._v("模式不会受到类似的影响。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("最新的 Current 版本中的变化")]),_._v(" "),e("p",[_._v("参数 "),e("code",[_._v("CC")]),_._v(" 和 "),e("code",[_._v("CACHE")]),_._v(" 被删除。")]),_._v(" "),e("ul",[e("li",[_._v("STD：标准工作模式，等价于 "),e("code",[_._v("HEAD GET POST IP URL RBODY ARGS UA")]),_._v("。")]),_._v(" "),e("li",[_._v("STATIC：适用于静态站点的工作模式，等价于 "),e("code",[_._v("HEAD GET IP URL UA")]),_._v("。")]),_._v(" "),e("li",[_._v("DYNAMIC：适用于动态站点的工作模式，等价于 "),e("code",[_._v("HEAD GET POST IP URL ARGS UA RBODY COOKIE")]),_._v("。")]),_._v(" "),e("li",[_._v("LIBINJECTION：已移除。")]),_._v(" "),e("li",[_._v("LIBINJECTION-SQLI：已移除。")]),_._v(" "),e("li",[_._v("LIBINJECTION-XSS：已移除。")]),_._v(" "),e("li",[_._v("ADV：已移除。")])])]),_._v(" "),e("h2",{attrs:{id:"waf-cc-deny"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-cc-deny"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_cc_deny")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_cc_deny <rate="),e("em",[_._v("n")]),_._v("r/m> [duration="),e("em",[_._v("1h")]),_._v("] [size="),e("em",[_._v("20m")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：——")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("设置 CC 防护相关的参数。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("rate")]),_._v("：表示一段时间内的请求次数的上限，如 "),e("code",[_._v("500r/m")]),_._v("。超出限制后会返回 "),e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/503",target:"_blank",rel:"noopener noreferrer"}},[_._v("503 状态码"),e("OutboundLink")],1),_._v("，并附带 "),e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Retry-After",target:"_blank",rel:"noopener noreferrer"}},[_._v("Retry-After"),e("OutboundLink")],1),_._v(" 响应头。")]),_._v(" "),e("li",[e("code",[_._v("duration")]),_._v("：表示超出第一个参数 "),e("code",[_._v("rate")]),_._v(" 的限制后拉黑 IP 的时间，如 "),e("code",[_._v("60s")]),_._v("、"),e("code",[_._v("60m")]),_._v("、"),e("code",[_._v("60h")]),_._v(" 和 "),e("code",[_._v("60d")]),_._v("，如不指定则默认为 "),e("code",[_._v("1h")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("size")]),_._v("：用于设置记录 IP 访问次数的内存的大小，如 "),e("code",[_._v("20m")]),_._v("、"),e("code",[_._v("2048k")]),_._v("，不得小于 "),e("code",[_._v("20m")]),_._v("，如不指定则默认为 "),e("code",[_._v("20m")]),_._v("。当这段内存耗尽的时候程序会按照 LRU 策略清理一部分访问记录。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("最新的 Current 版本中的变化")]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_cc_deny <"),e("em",[_._v("off")]),_._v(" | "),e("em",[_._v("on")]),_._v("> <rate="),e("em",[_._v("n")]),_._v("r/t> <zone="),e("em",[_._v("name:tag")]),_._v("> [duration="),e("em",[_._v("1h")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：waf_cc_deny "),e("em",[_._v("off")])]),_._v(" "),e("li",[_._v("配置段: server, location")])]),_._v(" "),e("hr"),_._v(" "),e("ul",[e("li",[e("code",[_._v("zone")]),_._v("：指定所使用的共享内存和标签，用于记录 IP 的访问次数。当这段内存耗尽的时候程序会按照 LRU 策略清理一部分访问记录。")]),_._v(" "),e("li",[e("code",[_._v("rate")]),_._v("：表示一段时间内的请求次数的上限，如 "),e("code",[_._v("500r/s")]),_._v("、"),e("code",[_._v("500r/60s")]),_._v("、"),e("code",[_._v("500r/m")]),_._v("、"),e("code",[_._v("500r/60m")]),_._v("、"),e("code",[_._v("500r/h")]),_._v("、"),e("code",[_._v("500r/60h")]),_._v(" 和 "),e("code",[_._v("500r/d")]),_._v("。超出限制后会返回 "),e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/503",target:"_blank",rel:"noopener noreferrer"}},[_._v("503 状态码"),e("OutboundLink")],1),_._v("，并附带 "),e("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Retry-After",target:"_blank",rel:"noopener noreferrer"}},[_._v("Retry-After"),e("OutboundLink")],1),_._v(" 响应头。")])])]),_._v(" "),e("h2",{attrs:{id:"waf-cache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-cache"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_cache")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_cache <capacity="),e("em",[_._v("n")]),_._v(">")]),_._v(" "),e("li",[_._v("默认配置：—")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("设置缓存规则检查结果相关的参数。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("capacity")]),_._v("：对于一些启用了缓存机制的检测项目，每个检测项目最多缓存多少个检测目标的检测结果。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("启用了缓存机制的检测项目")]),_._v(" "),e("p",[_._v("启用了缓存机制的检测项目指除了 CC 防护、IP 黑白名单检测和 POST 检测之外的所有的检测项。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("性能优化建议")]),_._v(" "),e("p",[e("code",[_._v("capacity")]),_._v(" 过小会导致频繁地淘汰缓存，增加内存碎片，降低性能。所以请根据实际应用场景合理地设置。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("最新的 Current 版本中的变化")]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_cache <"),e("em",[_._v("off")]),_._v(" | "),e("em",[_._v("on")]),_._v("> [capacity="),e("em",[_._v("50")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：waf_cache "),e("em",[_._v("off")]),_._v(" capacity="),e("em",[_._v("50")])]),_._v(" "),e("li",[_._v("配置段: server, location")])])]),_._v(" "),e("h2",{attrs:{id:"waf-modsecurity"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-modsecurity"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_modsecurity")]),_._v(" "),e("Badge",{attrs:{text:"仅限最新的 Current 版本",type:"tip"}})],1),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_modsecurity <"),e("em",[_._v("on")]),_._v(" | "),e("em",[_._v("off")]),_._v("> <file=*/path/to/modsecuriy/rules.conf*> <remote_key="),e("em",[_._v("key")]),_._v("> <remote_url="),e("em",[_._v("url")]),_._v(">")]),_._v(" "),e("li",[_._v("默认配置：waf_modsecurity off")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("使用 ModSecurity 的规则。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("file")]),_._v("：规则文件的绝对路径。")]),_._v(" "),e("li",[e("code",[_._v("remote_key")]),_._v("：用于读取远程规则文件的密钥。")]),_._v(" "),e("li",[e("code",[_._v("remote_url")]),_._v("：用于读取远程文件的 URL。")])]),_._v(" "),e("p",[_._v("你可以参考 "),e("RouterLink",{attrs:{to:"/zh-cn/practice/enable-modsecurity.html"}},[_._v("开启 ModSecurity | 最佳实践")]),_._v(" 中的用法。")],1),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("注意")]),_._v(" "),e("ul",[e("li",[_._v("如果你使用了参数 "),e("code",[_._v("remote_key")]),_._v("，你必须同时使用参数 "),e("code",[_._v("remote_url")]),_._v("。")]),_._v(" "),e("li",[_._v("如果你同时使用了参数 "),e("code",[_._v("file")]),_._v("、"),e("code",[_._v("remote_key")]),_._v(" 和 "),e("code",[_._v("remote_url")]),_._v("，那么两份规则都会被加载。")])])]),_._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[_._v("内存泄露")]),_._v(" "),e("p",[e("strong",[_._v("内存泄露会导致系统的可用内存越来越少，性能逐渐降低直到程序或系统崩溃。")])]),_._v(" "),e("p",[_._v("当前 "),e("a",{attrs:{href:"https://github.com/SpiderLabs/ModSecurity",target:"_blank",rel:"noopener noreferrer"}},[_._v("ModSecurity"),e("OutboundLink")],1),_._v(" 的最新版 v3.0.5 存在内存泄露的 bug。")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/SpiderLabs/ModSecurity/issues/2552",target:"_blank",rel:"noopener noreferrer"}},[_._v("ngin reload memory leak · Issue #2552 · SpiderLabs/ModSecurity"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/SpiderLabs/ModSecurity/issues/2502",target:"_blank",rel:"noopener noreferrer"}},[_._v("It often leads memory leak on nginx reload · Issue #2502 · SpiderLabs/ModSecurity"),e("OutboundLink")],1)])]),_._v(" "),e("p",[_._v("如果您开启了 ModSecurity，重载 nginx 时会出现内存泄露，长此以往可能会造成严重的后果。")]),_._v(" "),e("p",[_._v("我们强烈建议您避免使用类似下面的命令。")]),_._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[_._v("nginx -s reload\nsystemctl restart nginx\n"),e("span",{pre:!0,attrs:{class:"token function"}},[_._v("service")]),_._v(" nginx restart\n")])])]),e("p",[_._v("当您需要重载 nginx 时，强烈建议先关闭 nginx，然后启动 nginx。")]),_._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[_._v("nginx -s stop "),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v("&&")]),_._v(" nginx\nsystemctl stop nginx "),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v("&&")]),_._v(" systemctl start nginx\n"),e("span",{pre:!0,attrs:{class:"token function"}},[_._v("service")]),_._v(" nginx stop "),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v("&&")]),_._v(" serivce nginx start\n")])])])]),_._v(" "),e("h2",{attrs:{id:"waf-modsecurity-transaction-id"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-modsecurity-transaction-id"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_modsecurity_transaction_id")]),_._v(" "),e("Badge",{attrs:{text:"仅限最新的 Current 版本",type:"tip"}})],1),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_modsecurity_transaction_id <"),e("em",[_._v("string")]),_._v(">")]),_._v(" "),e("li",[_._v("默认配置：waf_modsecurity off")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("指定 ModSecurity 的事务 ID。你可以在此处使用常量字符串和变量，下面是一个例子。")]),_._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("server")])]),_._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("{")]),_._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("location")]),_._v(" /file/")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("{")]),_._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("waf_modsecurity_transaction_id")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[_._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[_._v("$host")]),_._v('-file"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("}")]),_._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("location")]),_._v(" /api/")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("{")]),_._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("waf_modsecurity_transaction_id")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[_._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[_._v("$host")]),_._v('-api"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("}")]),_._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("}")]),_._v("\n")])])]),e("h2",{attrs:{id:"waf-captcha"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-captcha"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_captcha")]),_._v(" "),e("Badge",{attrs:{text:"仅限最新的 Current 版本",type:"tip"}})],1),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_captcha <"),e("em",[_._v("on")]),_._v(" | "),e("em",[_._v("off")]),_._v("> <prov="),e("em",[_._v("hCaptcha")]),_._v(" | "),e("em",[_._v("reCAPTCHAv2:checkbox")]),_._v(" | "),e("em",[_._v("reCAPTCHAv2:invisible")]),_._v(" | "),e("em",[_._v("reCAPTCHAv3")]),_._v("> [file="),e("em",[_._v("/full/path")]),_._v("] [sitekey="),e("em",[_._v("your_sitekey")]),_._v("] <secret="),e("em",[_._v("your_secret")]),_._v("> [score="),e("em",[_._v("0.5")]),_._v("] [expire=30m] [api="),e("em",[_._v("uri")]),_._v("] [verify="),e("em",[_._v("/captcha")]),_._v("] [max_fails="),e("em",[_._v("times:duration")]),_._v("] [zone="),e("em",[_._v("name:tag")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：waf_captcha "),e("em",[_._v("off")])]),_._v(" "),e("li",[_._v("配置段: server, location")])]),_._v(" "),e("p",[_._v("使用验证码对客户端进行人机识别。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("prov")]),_._v("：验证码平台，包含 "),e("a",{attrs:{href:"https://www.hcaptcha.com/",target:"_blank",rel:"noopener noreferrer"}},[_._v("hCaptcha"),e("OutboundLink")],1),_._v("、"),e("a",{attrs:{href:"https://www.google.com/recaptcha/about/",target:"_blank",rel:"noopener noreferrer"}},[_._v("reCAPTCHAv2"),e("OutboundLink")],1),_._v(" 和 "),e("a",{attrs:{href:"https://www.google.com/recaptcha/about/",target:"_blank",rel:"noopener noreferrer"}},[_._v("reCAPTCHAv3"),e("OutboundLink")],1),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("file")]),_._v("：用于接入验证码的 HTML 文件的绝对路径，你可以从 "),e("code",[_._v("assets/")]),_._v(" 下找到对应的 HTML 文件并在文件中填写你的 "),e("code",[_._v("Sitekey")]),_._v("。如果你省略此参数，则会根据参数 "),e("code",[_._v("prov")]),_._v(" 的值选择并使用一个内置的 HTML 文件（来自目录 "),e("code",[_._v("assets/")]),_._v("），此时你需要设置参数 "),e("code",[_._v("sitekey")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("sitekey")]),_._v("：你从验证码平台获取的网站密钥，当且仅当参数 "),e("code",[_._v("file")]),_._v(" 被省略时需要设置本参数。")]),_._v(" "),e("li",[e("code",[_._v("secret")]),_._v("：用于确认验证码的运行结果的密钥，你可以从对应的验证码平台获得。")]),_._v(" "),e("li",[e("code",[_._v("socre")]),_._v("：当 "),e("code",[_._v("prov=reCAPTCHAv3")]),_._v(" 时，这个表示验证码打分结果的下限，低于这个值会被视为验证失败。默认值为 "),e("code",[_._v("0.5")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("expire")]),_._v("：验证码的过期时间，过期后需要重新运行验证码。默认为 30 分钟。")]),_._v(" "),e("li",[e("code",[_._v("api")]),_._v("：验证码平台的提供给服务端的 API，用于确认验证码的运行结果。\n"),e("ul",[e("li",[_._v("如果 "),e("code",[_._v("prov=hCaptcha")]),_._v("，则默认值为 "),e("code",[_._v("https://hcaptcha.com/siteverify")]),_._v("。")]),_._v(" "),e("li",[_._v("如果 "),e("code",[_._v("prov=reCAPTCHAv2:xxx")]),_._v("，则默认值为 "),e("code",[_._v("https://www.recaptcha.net/recaptcha/api/siteverify")]),_._v("。")]),_._v(" "),e("li",[_._v("如果 "),e("code",[_._v("prov=reCAPTCHAv3")]),_._v("，则默认值为 "),e("code",[_._v("https://www.recaptcha.net/recaptcha/api/siteverify")]),_._v("。")])])]),_._v(" "),e("li",[e("code",[_._v("verify")]),_._v("：验证码向后端提交 token 所用的 url，默认为 "),e("code",[_._v("/captcha")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("max_fails")]),_._v("：验证码最大刷新/试错次数，超出这个次数拉黑对应的 IP 一段时间。例如 "),e("code",[_._v("max_fails=20:5m")]),_._v(" 表示连续刷新/试错二十次后拉黑 5 分钟。当你使用计费的验证码时这很有用。当你设置了此参数，你必须同时设置参数 "),e("code",[_._v("zone")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("zone")]),_._v("：设置用于记录验证码试错次数的共享内存，当且仅当参数 "),e("code",[_._v("max_fails")]),_._v(" 被设置时才需要设置此参数。")])]),_._v(" "),e("p",[_._v("你可以参考"),e("RouterLink",{attrs:{to:"/zh-cn/practice/enable-captcha.html"}},[_._v("开启验证码 | 最佳实践")]),_._v("中的用例。")],1),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("自定义验证码页面")]),_._v(" "),e("p",[_._v("你可以以目录 "),e("code",[_._v("assets/")]),_._v(" 下的 HTML 文件为基础，自定义验证码页面，然后通过参数 "),e("code",[_._v("file")]),_._v("加载。")]),_._v(" "),e("p",[_._v("不要忘记在 HTML 文件中填写 "),e("code",[_._v("sitekey")]),_._v("。")])]),_._v(" "),e("h2",{attrs:{id:"waf-verify-bot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-verify-bot"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_verify_bot")]),_._v(" "),e("Badge",{attrs:{text:"仅限最新的 Current 版本",type:"tip"}})],1),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_verify_bot <"),e("em",[_._v("off")]),_._v(" | "),e("em",[_._v("on")]),_._v(" | "),e("em",[_._v("strict")]),_._v("> ["),e("em",[_._v("who")]),_._v("] ...")]),_._v(" "),e("li",[_._v("默认配置：waf_verify_bot "),e("em",[_._v("off")]),_._v(" "),e("em",[_._v("GoogleBot")]),_._v(" "),e("em",[_._v("BingBot")]),_._v(" "),e("em",[_._v("BaiduSpider")]),_._v(" "),e("em",[_._v("YandexBot")]),_._v(" "),e("em",[_._v("SogouSpider")])]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("验证友好的爬虫，比如百度蜘蛛。")]),_._v(" "),e("p",[_._v("如果第一个参数是 "),e("code",[_._v("on")]),_._v(" 则会停止后续的所有检查并放行本次请求。")]),_._v(" "),e("p",[_._v("如果第一个参数是 "),e("code",[_._v("strict")]),_._v("，则如果某个请求的 User-Agent 正确，但是 IP 地址不正确则会被拦截（有误报）。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("who")]),_._v("：爬虫的名称，取值包括 "),e("code",[_._v("GoogleBot")]),_._v("、"),e("code",[_._v("BingBot")]),_._v("、"),e("code",[_._v("BaiduSpider")]),_._v("、 "),e("code",[_._v("YandexBot")]),_._v(" 和 "),e("code",[_._v("SogouSpider")]),_._v("。如不指定则默认为全部。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("工作原理")]),_._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://developers.google.com/search/docs/advanced/crawling/overview-google-crawlers",target:"_blank",rel:"noopener noreferrer"}},[_._v("Overview of Google crawlers (user agents)  |  Search Central"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://developers.google.com/search/docs/advanced/crawling/verifying-googlebot",target:"_blank",rel:"noopener noreferrer"}},[_._v("Googlebot Verification | Google Search Central  |  Google Developers"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://www.bing.com/webmasters/help/which-crawlers-does-bing-use-8c184ec0",target:"_blank",rel:"noopener noreferrer"}},[_._v("Which Crawlers Does Bing Use? - Bing Webmaster Tools"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://www.bing.com/webmasters/help/how-to-verify-bingbot-3905dc26",target:"_blank",rel:"noopener noreferrer"}},[_._v("How to Verify Bingbot"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://help.baidu.com/question?prod_id=99&class=0&id=3001",target:"_blank",rel:"noopener noreferrer"}},[_._v("百度用户服务中心-站长平台"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://yandex.com/support/webmaster/robot-workings/check-yandex-robots.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("How to check that a robot belongs to Yandex"),e("OutboundLink")],1)]),_._v(" "),e("li",[e("a",{attrs:{href:"https://zhanzhang.sogou.com/index.php/help/spider",target:"_blank",rel:"noopener noreferrer"}},[_._v("搜狗资源平台_公平开放的交流平台"),e("OutboundLink")],1)])])]),_._v(" "),e("h2",{attrs:{id:"waf-under-attack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-under-attack"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_under_attack")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_under_attack <"),e("em",[_._v("on")]),_._v(" | "),e("em",[_._v("off")]),_._v("> [uri="),e("em",[_._v("str")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：waf_under_attack off")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("如果您的站点正在受到攻击可以尝试使用此配置。\n开启后每个用户首次访问会强制延迟五秒，并自动跳转到 "),e("code",[_._v("uri")]),_._v(" 所指向的网页。")]),_._v(" "),e("p",[_._v("如果攻击者采用攻击方式不能完美支持 Cookie，本功能可以大幅度缓解此类攻击造成的影响。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("uri")]),_._v(": 可以是一个完整的网址，也可以是一个路径。比如 "),e("code",[_._v("https://example.com/attack.html")]),_._v(" 或 "),e("code",[_._v("/attack.html")]),_._v("。")])]),_._v(" "),e("p",[_._v("你可以参考"),e("RouterLink",{attrs:{to:"/zh-cn/practice/protect-against-distributed-http-flood.html"}},[_._v("抵御分布式 CC 攻击（HTTP 洪水） | 最佳实践")]),_._v("中的用例。")],1),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("小技巧")]),_._v(" "),e("p",[e("code",[_._v("uri")]),_._v(" 所指向的网页应该在五秒后自动跳转到用户想要访问的页面，页面的网址可以通过查询字符串获得，参数名为 "),e("code",[_._v("target")]),_._v("。")]),_._v(" "),e("p",[e("code",[_._v("assets/under-attack.html")]),_._v(" 是一个示例网页，你应该将这个文件拷贝到你的网站目录下，并正确地配置 "),e("code",[_._v("uri")]),_._v("。")]),_._v(" "),e("p",[_._v("你自然也可以自己编写一个 html 文件，然后通过 "),e("code",[_._v("uri")]),_._v(" 指向它。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("最新的 Current 版本中的变化")]),_._v(" "),e("p",[_._v("在 LTS 版本中我们通过重定向实现了该功能，但是许多原因（如缓存和 CDN）会导致重定向失败，或者不能正常验证 Cookie。\n所以我们修改了实现方式，我们通过修改响应体来返回指定的网页，这种方式不会导致 URI 的改变。")]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_under_attack <"),e("em",[_._v("on")]),_._v(" | "),e("em",[_._v("off")]),_._v("> [file="),e("em",[_._v("full_path")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置：waf_under_attack "),e("em",[_._v("off")])]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("同时我们增加了响应头 "),e("code",[_._v("Cache-Control: no-store")]),_._v(" 以避免缓存带来的影响。")]),_._v(" "),e("ul",[e("li",[_._v("移除了参数 "),e("code",[_._v("uri")]),_._v("。")]),_._v(" "),e("li",[_._v("增加了参数 "),e("code",[_._v("file")]),_._v("，该参数的值应该是一个 HTML 文件的绝对路径，如 "),e("code",[_._v("file=/path/to/under-attack.html")]),_._v("。这个 HTML 只有一个功能，即五秒后自动刷新。当你省略此参数时，默认使用内置的 HTML 文件，它来自 "),e("code",[_._v("assets/under-attack.html")]),_._v("。")])])]),_._v(" "),e("h2",{attrs:{id:"waf-priority"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-priority"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_priority")])]),_._v(" "),e("ul",[e("li",[_._v('配置语法: waf_priority "'),e("em",[_._v("str")]),_._v('"')]),_._v(" "),e("li",[_._v('默认配置：waf_priority "W-IP IP CC UNDER-ATTACK W-URL URL ARGS UA W-REFERER REFERER COOKIE ADV"')]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("设置各个检测项目的优先级，除了 POST 检测，POST 检测的优先级永远最低。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("UNDER-ATTACK")]),_._v(": 配置 "),e("code",[_._v("waf_under_attack")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("W-IP")]),_._v("：IP 白名单检测")]),_._v(" "),e("li",[e("code",[_._v("IP")]),_._v("：IP 黑名单检测")]),_._v(" "),e("li",[e("code",[_._v("CC")]),_._v("：CC 防护")]),_._v(" "),e("li",[e("code",[_._v("W-URL")]),_._v("：URL 白名单检测")]),_._v(" "),e("li",[e("code",[_._v("URL")]),_._v("：URL 黑名单检测")]),_._v(" "),e("li",[e("code",[_._v("ARGS")]),_._v("：URL 参数（查询字符串）黑名单检测")]),_._v(" "),e("li",[e("code",[_._v("UA")]),_._v("：User-Agent 黑名单检测")]),_._v(" "),e("li",[e("code",[_._v("W-REFERER")]),_._v("：Referer 白名单检测")]),_._v(" "),e("li",[e("code",[_._v("REFERER")]),_._v("：Referer 黑名单检测")]),_._v(" "),e("li",[e("code",[_._v("COOKIE")]),_._v("：Cookie 黑名单检测")]),_._v(" "),e("li",[e("code",[_._v("ADV")]),_._v("：表示高级规则。")])]),_._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[_._v("警告")]),_._v(" "),e("p",[e("code",[_._v("str")]),_._v(" 必须使用单引号或者双引号包裹，且 "),e("code",[_._v("str")]),_._v(" 必须包含全部的检测项目。")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("最新的 Current 版本中的变化")]),_._v(" "),e("ul",[e("li",[_._v('默认配置：waf_priority "W-IP IP VERIFY-BOT CC CAPTCHA UNDER-ATTACK W-URL URL ARGS UA W-REFERER REFERER COOKIE POST MODSECURITY"')])]),_._v(" "),e("hr"),_._v(" "),e("ul",[e("li",[e("code",[_._v("VERIFY-BOT")]),_._v("：友好爬虫验证。")]),_._v(" "),e("li",[e("code",[_._v("CAPTCHA")]),_._v("：验证码。")]),_._v(" "),e("li",[e("code",[_._v("POST")]),_._v("：请求体黑名单。")]),_._v(" "),e("li",[e("code",[_._v("ADV")]),_._v("：已经移除。")]),_._v(" "),e("li",[e("code",[_._v("MODSECURITY")]),_._v("。")])])]),_._v(" "),e("h2",{attrs:{id:"waf-http-status"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-http-status"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_http_status")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_http_status [general="),e("em",[_._v("http_status_code")]),_._v("] [cc_deny="),e("em",[_._v("http_status_code")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置: waf_http_status general=403 cc_deny=503")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("此指令用于设置请求被拦截时返回的 HTTP 状态码。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("general")]),_._v(": 表示所有基于黑名单的检测项目触发后返回的 HTTP 状态码。")]),_._v(" "),e("li",[e("code",[_._v("cc_deny")]),_._v("：表示 CC 防护触发后返回的 HTTP 状态码。")])]),_._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[_._v("最新的 Current 版本中的变化")]),_._v(" "),e("p",[_._v("此配置从 "),e("code",[_._v("v10.0.0")]),_._v(" 开始被移除，相关的功能移动到配置 "),e("a",{attrs:{href:"#waf-action"}},[_._v("waf_action")]),_._v("。")])]),_._v(" "),e("h2",{attrs:{id:"waf-action"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-action"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_action")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_action [blacklist="),e("em",[_._v("action")]),_._v("] [cc_deny="),e("em",[_._v("action")]),_._v("] [modsecurity="),e("em",[_._v("action")]),_._v("] [verify_bot="),e("em",[_._v("action")]),_._v("] [zone="),e("em",[_._v("name:tag")]),_._v("]")]),_._v(" "),e("li",[_._v("默认配置: waf_action "),e("em",[_._v("blacklist=403")]),_._v(" "),e("em",[_._v("cc_deny=503")]),_._v(" "),e("em",[_._v("modsecurity=follow")]),_._v(" "),e("em",[_._v("verify_bot=403")])]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("此配置用于设置拦截一个请求时的动作，"),e("code",[_._v("action")]),_._v(" 表示具体的动作，可以是以下值。")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("4xx | 5xx")]),_._v("：表示返回 HTTP 状态码。")]),_._v(" "),e("li",[e("code",[_._v("CAPTCHA")]),_._v("：表示启用验证码进行验证，只有通过验证才解除拉黑。同时，你必须设置 "),e("a",{attrs:{href:"#waf-captcha"}},[_._v("waf_captcha")]),_._v("。")]),_._v(" "),e("li",[e("code",[_._v("follow")]),_._v("：尊重 ModSecurity 规则的动作，仅可用于参数 "),e("code",[_._v("modsecurity")]),_._v("。")])]),_._v(" "),e("p",[_._v("参数说明：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("blacklist")]),_._v("：表示所有基于黑名单的规则，比如 IP 黑名单、User-Agent 黑名单、URL 黑名单等。")]),_._v(" "),e("li",[e("code",[_._v("cc_deny")]),_._v(": CC 防护。")]),_._v(" "),e("li",[e("code",[_._v("modsecurity")]),_._v("：ModSecurity 规则。")]),_._v(" "),e("li",[e("code",[_._v("verify_bot")]),_._v("：友好爬虫验证。")]),_._v(" "),e("li",[e("code",[_._v("zone")]),_._v("：设置用于记录必要信息的共享内存，当且仅当某个 "),e("code",[_._v("action")]),_._v(" 为 "),e("code",[_._v("CAPTCHA")]),_._v(" 时才需要设置。")])]),_._v(" "),e("h2",{attrs:{id:"waf-block-page"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#waf-block-page"}},[_._v("#")]),_._v(" "),e("code",[_._v("waf_block_page")])]),_._v(" "),e("ul",[e("li",[_._v("配置语法: waf_block_page < "),e("em",[_._v("default")]),_._v(" | "),e("em",[_._v("path/to/file.html")]),_._v(" >")]),_._v(" "),e("li",[_._v("默认配置: ——")]),_._v(" "),e("li",[_._v("配置段: http, server, location")])]),_._v(" "),e("p",[_._v("用于设置当请求被拦截时返回的页面，"),e("code",[_._v("default")]),_._v(" 为一个内置的 HTML 文件，它来自 "),e("code",[_._v("assets/block.html")]),_._v("，[数据删除] 是 [数据删除]。")])])}),[],!1,null,null,null);v.default=a.exports}}]);